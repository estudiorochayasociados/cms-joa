<?php
require_once "Config/Autoload.php";
Config\Autoload::runSitio();
$template = new Clases\TemplateSite();
$funciones= new Clases\PublicFunction();
$template->set("title", "Admin");
$template->set("description", "Admin");
$template->set("keywords", "Inicio");
$template->set("favicon", LOGO);
$template->themeInit();
//
$pagina = isset($_GET["pagina"]) ? $_GET["pagina"] : '0'; 
//Clases
$productos = new Clases\Productos();
$imagenes = new Clases\Imagenes();
$categorias = new Clases\Categorias();
$banners = new Clases\Banner();
//Banners
$categoriasData = $categorias->list('');
foreach($categoriasData as $valor){
    if($valor['titulo']=='Pie' && $valor['area']=='banners'){ 
        $banners->set("categoria",$valor['cod']);
        $banDataPie = $banners->listForCategory();
    }

    if($valor['titulo']=='Side' && $valor['area']=='banners'){
        $banners->set("categoria",$valor['cod']);
        $banDataSide = $banners->listForCategory();  
    }
}
//Productos
$categorias->set("area","productos");
$categoriasParaProductos= $categorias->listForSearch('');
$productData = $productos->listWithOps('','',(5*$pagina) .','. 5);
$productDataSide = $productos->listWithOps('','','4');
$productosPaginador = $productos->paginador('',5);
//
?>

            <!-- CONTENT -->
            <div id="sns_content" class="wrap layout-lm">
                <div class="container">
                    <div class="row">

                        <!-- sns_left -->
                        <div id="sns_left" class="col-md-3">
                            <div class="wrap-in">
                                <div class="block block-layered-nav block-layered-nav--no-filters">
                                    <div class="block-title">
                                        <strong>
                                            <span>Shop By</span>
                                        </strong>
                                    </div>
                                    <div class="block-content toggle-content">
                                        <dl id="narrow-by-list">
                                            <dt class="odd">Categories</dt>
                                            <dd class="odd">
                                                <ol>
                                                    <?php
                                                    foreach ($categoriasParaProductos as $catList) {
                                                    ?>
                                                        <li>
                                                        <a href="#">
                                                        <?=$catList['titulo']?>
                                                            <span class="count">(<?=$catList['count(categoria)']?>)</span>
                                                        </a>
                                                    </li>
                                                    <?php
                                                    } 
                                                    ?>
                                                </ol>
                                            </dd>

                                            <dt class="odd">Precio</dt>
                                            <dd class="odd">
                                                <ol class="js-price">
                                                    <li><input type="text" id="amount-1" readonly style="border:0; color:#666;" value="0"></li>
                                                    <li><input type="text" id="amount-2" readonly style="border:0; color:#666;" value="9999"></li>
                                                    <li class="style3">Filtrar</li>
                                                </ol>
                                              <div id="slider-range"></div>
                                            </dd>
                                        </dl>
                                    </div>
                                </div>
                                <?php
                                if (count($banDataSide)!=''){
                                    $banRandSide = $banDataSide[array_rand($banDataSide)];
                                    $imagenes->set("codigo",$banRandSide['cod']);
                                    $imgRandSide = $imagenes->view();
                                    $banners->set("id",$banRandSide['id']);
                                    $value=$banRandSide['vistas']+1;
                                    $banners->set("vistas",$value);
                                    $banners->increaseViews();
                                ?>
                                <div class="block block_cat">
                                    <a class="banner5" href="<?= $banRandSide['link'] ?>">
                                        <img src="<?=URL. '/' . $imgRandSide['ruta'] ?>" alt=<?= $banRandSide['nombre']?>">
                                    </a>
                                </div>
                                <?php
                                }
                                ?>
                                <div class="bestsale">
                                    <div class="title">
                                        <h3>Recomendados</h3>
                                    </div>
                                    <div class="content">
                                        <div class="products-slider12  owl-theme" style="display: inline-block">
                                                <?php
                                                if (count($productDataSide)>=5) {
                                                    $cont = 5;
                                                }else{ $cont = count($productDataSide); }
                                                for ($i=0; $i < $cont ; $i++) { 
                                                        $proRandSide = $productDataSide[array_rand($productDataSide)];
                                                        $imagenes->set("codigo",$proRandSide['cod']);
                                                        $imgProSide = $imagenes->view();
                                                        if (($key = array_search($proRandSide, $productDataSide)) !== false) {
                                                            unset($productDataSide[$key]);
                                                        }
                                                ?>
                                                    <div class="item">
                                                    <div class="item-inner">
                                                        <div class="prd">
                                                            <div class="item-img clearfix">
                                                                <a class="product-image have-additional" href="<?php echo URL . '/producto/' . $funciones->normalizar_link($proRandSide['titulo']) . "/" . $proRandSide['id'] ?>">
                                                                    <span class="img-main">
                                                                        <img alt="" src="<?=URL. '/' . $imgProSide['ruta'] ?>">
                                                                    </span>
                                                                </a>
                                                            </div>
                                                            <div class="item-info">
                                                                <div class="info-inner">
                                                                    <div class="item-title">
                                                                        <a href="<?php echo URL . '/producto/' . $funciones->normalizar_link($proRandSide['titulo']) . "/" . $proRandSide['id'] ?>"> <?= $proRandSide['titulo'] ?> </a>
                                                                    </div>
                                                                    <div class="item-price">
                                                                        <span class="price">
                                                                        <?php
                                                                                    if ($proRandSide['precioDescuento']>0) {
                                                                                    ?>
                                                                                       <span class="precioS1">$ <?= $proRandSide['precioDescuento']; ?></span>
                                                                                       <span class="precioS2">$ <?= $proRandSide['precio']; ?></span>
                                                                                    <?php
                                                                                    }else {
                                                                                    ?>
                                                                                        <span class="precioS1">$ <?= $proRandSide['precio']; ?></span>
                                                                                    <?php
                                                                                    }
                                                                                ?>
                                                                        </span>
                                                                    </div>
                                                                </div>
                                                                <div class="action-bot">
                                                                    <div class="wrap-addtocart">
                                                                        <button class="btn-cart" >
                                                                            <i class="fa fa-shopping-cart"></i>
                                                                            <span>Añadir</span>
                                                                        </button>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        </div>
                                                </div>
                                                <?php
                                                }
                                                ?>
                                        </div>
                                    </div>
                                </div>


                            </div>
                        </div>
                        <!-- sns_left -->


                         <div id="sns_main" class="col-md-9 col-main">
                             <div id="sns_mainmidle">
                                <?php
                                if (count($banDataPie)!=''){
                                    $banRandPie = $banDataPie[array_rand($banDataPie)];
                                    $imagenes->set("codigo",$banRandPie['cod']);
                                    $imgRandPie = $imagenes->view();
                                    $banners->set("id",$banRandPie['id']);
                                    $valuePie=$banRandPie['vistas']+1;
                                    $banners->set("vistas",$valuePie);
                                    $banners->increaseViews();
                                ?>
                                <div class="category-cms-block"></div>
                                 <p class="category-image banner5">
                                    <a href="<?= $banRandPie['link'] ?>">
                                        <img src="<?=URL. '/' . $imgRandPie['ruta'] ?>" alt="<?= $banRandPie['nombre']?>">
                                    </a>
                                </p>
                                <?php
                                }
                                ?>

                                 <div class="category-products">

                                     <!-- toolbar clearfix -->

                                     <div class="toolbar clearfix">
                                         <div class="toolbar-inner">
                                             <div class="limiter">
                                                 <label>Show</label>
                                                 <div class="select-new">
                                                     <div class="select-inner jqtransformdone">
                                                         <div class="jqTransformSelectWrapper" style="z-index: 10; width: 80px;">
                                                             <div>
                                                                 <span style="width: 50px;"> 20 </span>
                                                                 <a class="jqTransformSelectOpen" href="#"></a>
                                                             </div>
                                                             <ul style="width: 78px; display: none; visibility: visible;">
                                                                 <li>
                                                                     <a class="selected" href="#"> 20 </a>
                                                                 </li>
                                                                 <li>
                                                                     <a href="#"> 28 </a>
                                                                 </li>
                                                                 <li>
                                                                     <a href="#"> 36 </a>
                                                                 </li>
                                                             </ul>
                                                             <select class="select-limit-show jqTransformHidden" onchange="setLocation(this.value)" style="">
                                                                 <option selected="selected" value="http://demo.snstheme.com/sns-simen/index.php/women.html?limit=20"> 20 </option>
                                                                 <option value="http://demo.snstheme.com/sns-simen/index.php/women.html?limit=28"> 28 </option>
                                                                 <option value="http://demo.snstheme.com/sns-simen/index.php/women.html?limit=36"> 36 </option>
                                                             </select>
                                                         </div>
                                                     </div>
                                                 </div>
                                                 <span>per page</span>
                                             </div>
                                             <div class="sort-by">
                                                 <label>Sort by</label>
                                                 <div class="select-new">
                                                     <div class="select-inner jqtransformdone">
                                                         <div class="jqTransformSelectWrapper" style="z-index: 10; width: 118px;">
                                                             <div>
                                                                 <span style="width: 50px;"> Position </span>
                                                                 <a class="jqTransformSelectOpen" href="#"></a>
                                                             </div>
                                                             <ul style="width: 116px; display: none; visibility: visible;">
                                                                 <li class="active">
                                                                     <a class="selected" href="#"> Position </a>
                                                                 </li>
                                                                 <li>
                                                                     <a href="#"> Name </a>
                                                                 </li>
                                                                 <li>
                                                                     <a href="#"> Price </a>
                                                                 </li>
                                                             </ul>
                                                             <select class="select-sort-by jqTransformHidden" onchange="setLocation(this.value)" style="">
                                                                 <option selected="selected"> Position </option>
                                                                 <option> Name </option>
                                                                 <option> Price </option>
                                                             </select>
                                                         </div>
                                                     </div>
                                                 </div>
                                                <!--  <a class="set-desc" title="Set Descending Direction" href="http://demo.snstheme.com/sns-simen/index.php/women.html?dir=desc&order=position"></a> -->
                                             </div>
                                             <div class="pager">
                                                 <p class="amount">
                                                     <?= count($productData) ?> productos (s)
                                                 </p>
                                                 <div class="pages">
                                                     <strong>Pages:</strong>
                                                     <ol>
                                                         <li class="current">1</li>
                                                         <li>
                                                             <a href="#">2</a>
                                                         </li>
                                                         <li>
                                                             <a href="#">3</a>
                                                         </li>
                                                         <li>
                                                             <a class="next i-next" title="Next" href="#"> Next </a>
                                                         </li>
                                                     </ol>
                                                 </div>
                                             </div>
                                         </div>
                                     </div>
                                     <!-- toolbar clearfix -->



                                     <!-- sns-products-container -->
                                     <div class="sns-products-container clearfix">
                                         <div class="products-grid row style_grid">

                                             <?php
                                                foreach($productData as $productos){
                                                    $imagenes->set("codigo",$productos['cod']);
                                                    $imgProCenter1 = $imagenes->view();    
                                                ?>
                                                    <div class="item col-lg-3 col-md-4 col-sm-4 col-xs-6 col-phone-12">
                                                     <div class="item-inner">
                                                         <div class="prd">
                                                             <div class="item-img clearfix">
                                                             <div class="ico-label">
                                                                <?php
                                                                    if ($productos['precioDescuento']>0) {
                                                                    ?>
                                                                       <span class="ico-product ico-sale">Promo</span>
                                                                    <?php
                                                                    }
                                                                ?>
                                                                </div>
                                                                 <a class="product-image have-additional"
                                                                    href="<?php echo URL . '/producto/' . $funciones->normalizar_link($productos['titulo']) . "/" . $productos['id'] ?>"> 
                                                                    <span class="img-main">
                                                                   <img src="<?= URL. '/' . $imgProCenter1['ruta'] ?>" alt="">
                                                                    </span>
                                                                 </a>
                                                             </div>
                                                             <div class="item-info">
                                                                 <div class="info-inner">
                                                                     <div class="item-title">
                                                                         <a
                                                                            href="<?php echo URL . '/producto/' . $funciones->normalizar_link($productos['titulo']) . "/" . $productos['id'] ?>"> 
                                                                             <?= $productos['titulo'] ?> </a>
                                                                     </div>
                                                                     <div class="item-price">
                                                                         <div class="price-box">
                                                                    <span class="regular-price">
                                                                        <span class="price">
                                                                        <?php
                                                                                    if ($productos['precioDescuento']>0) {
                                                                                    ?>
                                                                                       <span class="precio1">$ <?= $productos['precioDescuento']; ?></span>
                                                                                       <span class="precio2">$ <?= $productos['precio']; ?></span>
                                                                                    <?php
                                                                                    }else {
                                                                                    ?>
                                                                                        <span class="precio1">$ <?= $productos['precio']; ?></span>
                                                                                    <?php
                                                                                    }
                                                                                ?>
                                                                        </span>
                                                                    </span>
                                                                         </div>
                                                                     </div>
                                                                 </div>
                                                             </div>
                                                             <div class="action-bot">
                                                                 <div class="wrap-addtocart">
                                                                     <button class="btn-cart"
                                                                             >
                                                                         <i class="fa fa-shopping-cart"></i>
                                                                         <span>Añadir</span>
                                                                     </button>
                                                                 </div>
                                                                 <div class="actions">
                                                                     <ul class="add-to-links">
                                                                         <li class="wrap-quickview" data-id="qv_item_7">
                                                                             <div class="quickview-wrap">
                                                                                 <a class="sns-btn-quickview qv_btn"
                                                                                    href="<?php echo URL . '/producto/' . $funciones->normalizar_link($productos['titulo']) . "/" . $productos['id'] ?>">
                                                                                     <i class="fa fa-eye"></i>
                                                                                 </a>
                                                                             </div>
                                                                         </li>
                                                                     </ul>
                                                                 </div>
                                                             </div>
                                                         </div>
                                                     </div>
                                                 </div>
                                                <?php
                                                }
                                                ?>
                                         </div>
                                     </div>
                                     <!-- sns-products-container -->


                                     <!-- toolbar clearfix  bottom-->
                                     <div class="toolbar clearfix">
                                         <div class="toolbar-inner">
                                             <div class="pager">
                                                 <p class="amount">
                                                 <?= count($productData) ?> productos (s)
                                                 </p>
                                                 <div class="pages">
                                                     <strong>Pages:</strong>
                                                     <ol>
                                                         <li class="current">1</li>
                                                         <li>
                                                             <a href="#">2</a>
                                                         </li>
                                                         <li>
                                                             <a href="#">3</a>
                                                         </li>
                                                         <li>
                                                             <a class="next i-next" title="Next" href="#"> Next </a>
                                                         </li>
                                                         <?php
	                                                        if($productosPaginador != 1 && $productosPaginador != 0) { 
	                                                        	$links = '';
	                                                        	$links .= "<li><a href='".URL."/productos"."/1'>1</a></li>";
	                                                        	$i = max(2, $pagina - 5);
                                                            
                                                                if ($i > 2){
	                                                        		$links .= "<li><a href='#'>...</a></li>";
	                                                        	}
                                                                for (;$i < min($pagina + 6, $productosPaginador); $i++) {
                                                                    $links .= "<li><a href='".URL."/productos"."/".$i."'>".$i."</a></li>";
                                                                }
                                                                if ($i != $productosPaginador){
                                                                    $links .= "<li><a href='#'>...</a></li>";
	                                                        		$links .= "<li><a href='".URL."/productos"."/".$productosPaginador."'>".$productosPaginador."</a></li>";
	                                                        	}	
                                                                echo $links;
                                                                echo "";
	                                                        }
	                                                        ?>	
                                                     </ol>
                                                 </div>
                                             </div>
                                         </div>
                                     </div>
                                     <!-- toolbar clearfix bottom -->
                                 </div>
                             </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- AND CONTENT -->

<?php
$template->themeEnd();
?>